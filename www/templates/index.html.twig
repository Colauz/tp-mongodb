{% extends "base.html.twig" %}

{% block title %}Index{% endblock %}

{% block content %}
    <h1>Liste des manuscrits de la bibliothèque du Patrimoine de Clermont Auvergne Métropole</h1>

    {# --- FORMULAIRE DE RECHERCHE --- #}
    <div class="card mb-4 bg-light">
        <div class="card-body">
            <form method="GET" action="app.php" class="d-flex gap-2">
                <input class="form-control" type="search" name="q" placeholder="Rechercher un titre, un auteur..." value="{{ search_query|default('') }}">
                <button class="btn btn-primary" type="submit">Rechercher</button>
                {% if search_query %}
                    <a href="app.php" class="btn btn-outline-secondary">Effacer</a>
                {% endif %}
            </form>
        </div>
    </div>

    {# --- Bouton d'ajout --- #}
    <div class="mb-3">
        <a href="create.php" class="btn btn-success">Ajouter un manuscrit</a>
    </div>

    {# --- Tableau des résultats --- #}
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>Référence</th>
            <th>Titre</th>
            <th>Auteur</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for document in list %}
            <tr>
                <td>{{ document.cote|default('N/A') }}</td>
                <td>{{ document.titre|default('Sans titre') }}</td>
                <td>{{ document.auteur|default('Anonyme') }}</td>

                <td>
                    <a href="get.php?id={{ document._id }}" class="btn btn-sm btn-info">Voir</a>
                    <a href="edit.php?id={{ document._id }}" class="btn btn-sm btn-warning">Éditer</a>
                    <a href="delete.php?id={{ document._id }}" class="btn btn-sm btn-danger" onclick="return confirm('Êtes-vous sûr ?')">Supprimer</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="4" class="text-center">
                    {% if search_query %}
                        Aucun résultat trouvé pour "<strong>{{ search_query }}</strong>".
                    {% else %}
                        Aucun document dans la base.
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}